<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Matter Software Update with EFR32 Example Applications &mdash; Silicon Labs Matter 2.0.0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/tabs.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Security" href="SECURITY.html" />
    <link rel="prev" title="Creating a Gecko Bootloader for Use in Matter OTA Software Update" href="OTA_BOOTLOADER.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Silicon Labs Matter
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../OVERVIEW.html">Silicon Labs Matter User’s Guide Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../NEW_FEATURES.html">Silicon Labs Matter New Features</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../nav_1_overview.html">Matter Overview</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="COMMISSIONING.html">Commissioning</a></li>
<li class="toctree-l2"><a class="reference internal" href="OT_SLEEPY_END_DEVICE.html">Matter Sleepy End Devices over OpenThread</a></li>
<li class="toctree-l2"><a class="reference internal" href="OTA_BOOTLOADER.html">Creating a Gecko Bootloader for Use in Matter OTA Software Update</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Matter Software Update with EFR32 Example Applications</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#running-the-ota-download-scenario">Running the OTA Download Scenario</a></li>
<li class="toctree-l3"><a class="reference internal" href="#internal-storage-bootloader">Internal Storage Bootloader</a></li>
<li class="toctree-l3"><a class="reference internal" href="#managing-the-software-version">Managing the Software Version</a></li>
<li class="toctree-l3"><a class="reference internal" href="#managing-the-vendor-and-product-id">Managing the Vendor and Product ID</a></li>
<li class="toctree-l3"><a class="reference internal" href="#additional-info">Additional Info</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="SECURITY.html">Security</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../nav_2_prereq.html">Matter Development Prerequisites</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nav_4_thread.html">Matter Over Thread</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nav_5_wifi.html">Matter Over Wi-Fi</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nav_3_general.html">Developer Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nav_6_faq.html">FAQ</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Silicon Labs Matter</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../nav_1_overview.html">Matter Overview</a></li>
      <li class="breadcrumb-item active">Matter Software Update with EFR32 Example Applications</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/overview/OTA_SOFTWARE_UPDATE.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="matter-software-update-with-efr32-example-applications">
<h1>Matter Software Update with EFR32 Example Applications<a class="headerlink" href="#matter-software-update-with-efr32-example-applications" title="Permalink to this headline"></a></h1>
<p><strong>([SIMPLICITY STUDIO] &amp; [GITHUB])</strong></p>
<p>The Over The Air (OTA) Software Update functionality is enabled by default for
all of the EFR32 example applications. Its inclusion in an application is
controlled by the <code class="docutils literal notranslate"><span class="pre">chip_enable_ota_requestor</span></code> compile flag.</p>
<section id="running-the-ota-download-scenario">
<h2>Running the OTA Download Scenario<a class="headerlink" href="#running-the-ota-download-scenario" title="Permalink to this headline"></a></h2>
<ul>
<li><p>For Matter with OpenThread: Bring up the OpenThread Border Router as
discussed in <a class="reference internal" href="../thread/DEMO_OVERVIEW.html"><span class="std std-doc">Thread Demo Overview</span></a> and get its operational
dataset.</p></li>
<li><p>On a Linux or Darwin platform build the chip-tool and the ota-provider-app
as follows:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>scripts/examples/gn_build_example.sh<span class="w"> </span>examples/chip-tool<span class="w"> </span>out/
</pre></div>
</div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>scripts/examples/gn_build_example.sh<span class="w"> </span>examples/ota-provider-app/linux<span class="w"> </span>out/debug<span class="w"> </span><span class="nv">chip_config_network_layer_ble</span><span class="o">=</span><span class="nb">false</span>
</pre></div>
</div>
</li>
<li><p>Build or download the Gecko Bootloader binary. Follow the instructions in
<a class="reference internal" href="OTA_BOOTLOADER.html"><span class="std std-doc">Creating the Bootloader for Use in Matter OTA</span></a>. For the
bootloader using the external flash select the “external SPI” bootloader
type configured with a single slot of at least 1000 KB. For the bootloader
using the internal flash see the Internal Storage Bootloader section below.
Pre-built binaries for some configurations are available on the
<a class="reference internal" href="../prerequisites/ARTIFACTS.html"><span class="std std-doc">Matter Artifacts page</span></a>, see README.md for details.</p></li>
<li><p>Using the commander tool, upload the bootloader to the device running the
application.</p></li>
<li><p>Create a bootable image file (using the Lighting application image as an
example):</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>commander<span class="w"> </span>gbl<span class="w"> </span>create<span class="w"> </span>chip-efr32-lighting-example.gbl<span class="w"> </span>--app<span class="w"> </span>chip-efr32-lighting-example.s37
</pre></div>
</div>
</li>
<li><p>Create the Matter OTA file from the bootable image file:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>./src/app/ota_image_tool.py<span class="w"> </span>create<span class="w"> </span>-v<span class="w"> </span>0xFFF1<span class="w"> </span>-p<span class="w"> </span>0x8005<span class="w"> </span>-vn<span class="w"> </span><span class="m">2</span><span class="w"> </span>-vs<span class="w"> </span><span class="s2">&quot;2.0&quot;</span><span class="w"> </span>-da<span class="w"> </span>sha256<span class="w"> </span>chip-efr32-lighting-example.gbl<span class="w"> </span>chip-efr32-lighting-example.ota
</pre></div>
</div>
</li>
<li><p>In a terminal start the Provider app and pass to it the path to the Matter
OTA file created in the previous step:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>rm<span class="w"> </span>-r<span class="w"> </span>/tmp/chip_*<span class="w"> </span>./out/debug/chip-ota-provider-app<span class="w"> </span>-f<span class="w"> </span>chip-efr32-lighting-example.ota
</pre></div>
</div>
</li>
<li><p>In a separate terminal run the chip-tool commands to provision the Provider:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>./out/chip-tool<span class="w"> </span>pairing<span class="w"> </span>onnetwork<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">20202021</span>
</pre></div>
</div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>./out/chip-tool<span class="w"> </span>accesscontrol<span class="w"> </span>write<span class="w"> </span>acl<span class="w"> </span><span class="s1">&#39;[{&quot;fabricIndex&quot;: 1, &quot;privilege&quot;: 5, &quot;authMode&quot;: 2, &quot;subjects&quot;: [112233], &quot;targets&quot;: null}, {&quot;fabricIndex&quot;: 1, &quot;privilege&quot;: 3, &quot;authMode&quot;: 2, &quot;subjects&quot;: null, &quot;targets&quot;: null}]&#39;</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span>
</pre></div>
</div>
</li>
<li><p>If the application device had been previously commissioned, hold Button 0
for six seconds to factory-reset the device.</p></li>
<li><p>In the chip-tool terminal enter:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>./out/chip-tool<span class="w"> </span>pairing<span class="w"> </span>ble-thread<span class="w"> </span><span class="m">2</span><span class="w"> </span>hex:&lt;operationalDataset&gt;<span class="w"> </span><span class="m">20202021</span><span class="w"> </span><span class="m">3840</span>
</pre></div>
</div>
</li>
</ul>
<p>where operationalDataset is obtained from the OpenThread Border Router.</p>
<ul>
<li><p>Once the commissioning process completes enter:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>./out/chip-tool<span class="w"> </span>otasoftwareupdaterequestor<span class="w"> </span>announce-ota-provider<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">0</span>
</pre></div>
</div>
</li>
<li><p>The application device will connect to the Provider and start the image
download. Once the image is downloaded the device will reboot into the
downloaded image.</p></li>
</ul>
</section>
<section id="internal-storage-bootloader">
<h2>Internal Storage Bootloader<a class="headerlink" href="#internal-storage-bootloader" title="Permalink to this headline"></a></h2>
<p>Internal storage bootloader for Matter OTA software update is supported on MG24
boards only. In this use case both the running image and the downloadable update
image must fit on the internal flash at the same time. This in turn requires
that both images are built with a reduced feature set, such as disabled logging
and Matter shell. The following set of compile flags leaves out all the optional
features and results in the minimal image size:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="nv">chip_detail_logging</span><span class="o">=</span><span class="nb">false</span>
<span class="w">    </span><span class="nv">chip_automation_logging</span><span class="o">=</span><span class="nb">false</span>
<span class="w">    </span><span class="nv">chip_progress_logging</span><span class="o">=</span><span class="nb">false</span>
<span class="w">    </span><span class="nv">is_debug</span><span class="o">=</span><span class="nb">false</span>
<span class="w">    </span><span class="nv">show_qr_code</span><span class="o">=</span><span class="nb">false</span>
<span class="w">    </span><span class="nv">chip_build_libshell</span><span class="o">=</span><span class="nb">false</span>
<span class="w">    </span><span class="nv">enable_openthread_cli</span><span class="o">=</span><span class="nb">false</span>
<span class="w">    </span><span class="nv">chip_openthread_ftd</span><span class="o">=</span><span class="nb">true</span>
</pre></div>
</div>
<p>Using LZMA compression when building the .gbl file ( passing <code class="docutils literal notranslate"><span class="pre">--compress</span> <span class="pre">lzma</span></code>
parameter to the <code class="docutils literal notranslate"><span class="pre">commander</span> <span class="pre">gbl</span> <span class="pre">create</span></code> command) further reduces the downloaded
image size.</p>
<p>When building an internal storage bootloader the two key configuration
parameters are the Slot Start Address and Slot Size in the Bootloader Storage
Slot component. The storage slot must not overlap with the running image and the
NVM section of the flash. In other words, the slot start address must be greater
than the end of the running image address and the sum of the start address and
the slot size must be less than the address of the NVM section. The simplest way
to get the relevant addresses for the running image and NVM is by using the
Silicon Labs <code class="docutils literal notranslate"><span class="pre">Simplicity</span> <span class="pre">Commander</span></code> (Device Info-&gt;Main Flash-&gt;Flash Map).</p>
<p>The pre-built bootloader binaries are configured with slot start address of
0x080EC000 and slot size of 548864</p>
</section>
<section id="managing-the-software-version">
<h2>Managing the Software Version<a class="headerlink" href="#managing-the-software-version" title="Permalink to this headline"></a></h2>
<p>In order for the Provider to successfully serve the image to a device during the
OTA Software Update process the Software Version parameter that the .ota file
was built with must be greater than the
CHIP_DEVICE_CONFIG_DEVICE_SOFTWARE_VERSION parameter set in the application’s
<code class="docutils literal notranslate"><span class="pre">CHIPProjectConfig.h</span></code> file. The Software Version parameter is set by the <code class="docutils literal notranslate"><span class="pre">-vn</span></code>
parameter passed to the <code class="docutils literal notranslate"><span class="pre">ota_image_tool.py</span> <span class="pre">create</span></code> command. For example, if the
application’s running image was built with
CHIP_DEVICE_CONFIG_DEVICE_SOFTWARE_VERSION set to 1 and if the <code class="docutils literal notranslate"><span class="pre">.ota</span></code> file is
built with <code class="docutils literal notranslate"><span class="pre">-vn</span> <span class="pre">2</span></code> then the Provider will serve the update image when requested.</p>
<p>In order for the OTA Software Update subsystem to consider an update to be
successful and for the NotifyUpdateApplied command to be transmitted the
CHIP_DEVICE_CONFIG_DEVICE_SOFTWARE_VERSION in the updated image must exceed the
software version of the running image (continuing the above example, the image
for the update must be built with CHIP_DEVICE_CONFIG_DEVICE_SOFTWARE_VERSION set
to 2).</p>
</section>
<section id="managing-the-vendor-and-product-id">
<h2>Managing the Vendor and Product ID<a class="headerlink" href="#managing-the-vendor-and-product-id" title="Permalink to this headline"></a></h2>
<p>Starting the ota-provider-app with the –otaImageList command line option allows
the user to supply a JSON file specifying the Software Version, Vendor and
Product ID that identify the image served by the Provider, see the ota-provider-app for linux in examples directory.</p>
<p>{<em><span class="xref myst">ota-provider-app</span></em>}</p>
<p>Example provider configuration file:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="w">        </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;foo&quot;</span><span class="o">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="c1">// ignored by parser</span>
<span class="w">          </span><span class="s">&quot;deviceSoftwareVersionModel&quot;</span><span class="o">:</span>
<span class="w">          </span><span class="p">[</span>
<span class="w">           </span><span class="p">{</span><span class="w"> </span>
<span class="w">            </span><span class="s">&quot;vendorId&quot;</span><span class="o">:</span><span class="w"> </span><span class="mi">65521</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;productId&quot;</span><span class="o">:</span><span class="w"> </span><span class="mi">32773</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;softwareVersion&quot;</span><span class="o">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;softwareVersionString&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;1.0.0&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cDVersionNumber&quot;</span><span class="o">:</span><span class="w"> </span><span class="mi">18</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;softwareVersionValid&quot;</span><span class="o">:</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;minApplicableSoftwareVersion&quot;</span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;maxApplicableSoftwareVersion&quot;</span><span class="o">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;otaURL&quot;</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;chip-efr32-lighting-example.ota&quot;</span><span class="w"> </span>
<span class="w">            </span><span class="p">}</span>
<span class="w">          </span><span class="p">]</span>
<span class="w">        </span><span class="p">}</span>
</pre></div>
</div>
</section>
<section id="additional-info">
<h2>Additional Info<a class="headerlink" href="#additional-info" title="Permalink to this headline"></a></h2>
<p>Developers can find more resources on
<a class="reference external" href="https://community.silabs.com/s/article/connected-home-over-ip-chip-faq?language=en_US">Silicon Labs Matter Community Page</a>
.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="OTA_BOOTLOADER.html" class="btn btn-neutral float-left" title="Creating a Gecko Bootloader for Use in Matter OTA Software Update" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="SECURITY.html" class="btn btn-neutral float-right" title="Security" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Silicon Labs.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>